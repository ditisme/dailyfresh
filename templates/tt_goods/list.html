{% extends 'tt_goods/base.html' %}

{% block head %}
	<title>天天生鲜-商品列表</title>
    <script>

    $(function () {
        $('.{{ order_by }}').addClass('active')
    })

    function add_cart(gid) {
        $.get('/user/islogin/', function (data) {

            if(data.islogin == 1){
                $.get('/cart/add/',{'gid':gid, 'count':1},function (data) {
                    if(data.isok == 1){
                        var $add_x = $('#'+gid).offset().top;
                        var $add_y = $('#'+gid).offset().left;

                        var $to_x = $('#show_count').offset().top;
                        var $to_y = $('#show_count').offset().left;
                        $(".add_jump").css({'left':$add_y+10,'top':$add_x,'display':'block'})

                        $(".add_jump").stop().animate({
                            'left': $to_y+7,
                            'top': $to_x+7},
                            "fast", function() {
                                $(".add_jump").fadeOut('fast',function(){
                                    $('#show_count').html( data.count);
                            })
                        })
                    }
                })
            }
            else{
                location.href('user/login/');
            }
        })
    }

    </script>
{% endblock head %}

{% block breadcrumb %}

	<div class="breadcrumb">
		<a href="/goods/">全部分类</a>
		<span>></span>
		<a href="#">新鲜水果</a>
	</div>

{% endblock breadcrumb %}

{% block r_wrap %}

    <div class="r_wrap fr clearfix">
        <div class="sort_bar">
            <a href="/goods/list/" class="-id">默认</a>
            <a href="/goods/list/?type={{ type_id }}&order_by=gprice" class="gprice">价格</a>
            <a href="/goods/list/?type={{ type_id }}&order_by=-gclick" class="-gclick">人气</a>
        </div>

        <ul class="goods_type_list clearfix">
            {% for goods in page %}
                <li>
                    <a href="/goods/detail/?gid={{ goods.id }}"><img src="/static/{{ goods.gpic }}"></a>
                    <h4><a href="/goods/detail/?gid={{ goods.id }}">{{ goods.gtitle }}</a></h4>
                    <div class="operate">
                        <span class="prize">￥{{ goods.gprice }}</span>
                        <span class="unit">{{ goods.gunit }}</span>
                        <a href="javascript:add_cart({{ goods.id }});" id="{{ goods.id }}" class="add_goods" title="加入购物车"></a>
                    </div>
                </li>
            {% endfor %}
        </ul>
        <div class="add_jump"></div>

        <div class="pagenation">
            {% if page.number > 1 %}
                <a href="/goods/list/?type={{ type_id }}&page={{ page.previous_page_number }}&order_by={{ order_by }}" class="active">上一页</a>
                <a href="/goods/list/?type={{ type_id }}&page=1&order_by={{ order_by }}" class="active">首页</a>
            {% else %}
                <a href="#" >上一页</a>
                <a href="#" >首页</a>
            {% endif %}

            {% for item in page_range %}
                {% if item == page.number %}
                    <a href="#" >{{ item }}</a>
                {% else %}
                    <a href="/goods/list/?type={{ type_id }}&page={{ item }}&order_by={{ order_by }}"  class="active">{{ item }}</a>
                {% endif %}
            {% endfor %}

            {% if page.number < page.paginator.num_pages %}
                <a href="/goods/list/?type={{ type_id }}&page={{ page.next_page_number }}&order_by={{ order_by }}" class="active">下一页</a>
                <a href="/goods/list/?type={{ type_id }}&page={{ page.paginator.num_pages }}&order_by={{ order_by }}" class="active">末页</a>
            {% else %}
                <a href="#" >下一页</a>
                <a href="#" >末页</a>
            {% endif %}
        </div>
    </div>

{% endblock r_wrap %}
